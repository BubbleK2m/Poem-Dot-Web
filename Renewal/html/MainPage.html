<!DOCTYPE html>
<html>
    <head>
        <title>메인페이지</title>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/moonspam/NanumSquare/master/nanumsquare.css">
        <link href="https://fonts.googleapis.com/css?family=Poiret+One" rel="stylesheet">
        <link href = "../css/MainPage.css" type="text/css" rel="stylesheet">
    </head>
    <body>
        <header>
            <div id = "mainLogo">Poem</div>
            <ul>
                <li><a>메인</a></li>
                <li><a>마이페이지</a></li>
                <li><a>로그아웃</a></li>
            </ul>
        </header>
        
        <div id = "poemBack">
            <!-- 임시 3개 --> 
            <div class = "sliders">
                <h1>나의 대표 시집</h1>
                <img src = "../imgs/poemTest2.jpg" class = "backImg">
                <div id = "poemPart">
                    <h2>별 헤는 밤</h2>
                    <h2 id = "author">윤 동 주</h2>
                    <h2 id = "explain">하늘과 바람과 별과 시를 노래하고 싶어서 만든 시입니다.</h2>

                    <img src = "../imgs/thumbUp.png" class="thumbUp">
                    <div id = "thumbCnt">
                        127
                    </div>
                </div>
                
                <div id = "showMoreText">
                    더 보기
                </div>
                <img src = "../imgs/plus.png" id = "showMore">
            </div>
        </div>
        
        <div id = "likePoem">
            <h1>
                좋아하는 시집
            </h1>

            <div id = "seeLikeMoreCover">
                <div id = "seeLikeMore">
                    더 보기
                </div>

                <img src = "../imgs/plus2.png">
            </div>

            <div id= "likePoemCover">
                <!--<div class = "likePoems">
                    <div class = "likePoemPics" id = "firstLike">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "likeAuthor">
                                    이소월
                                </span>
                                <br>
                                <span class = "likeCount">
                                    38
                                </span> 좋아요
                                <br>
                                <span class = "likeDate">
                                    2017/09/28
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "likePoemTitle">
                        <div class = "poemTitle">
                            계절의 여행    
                        </div>
                    </div>
                </div>
                <div class = "likePoems">
                    <div class = "likePoemPics" id = "secondLike">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "likeAuthor">
                                    정지우
                                </span>
                                <br>
                                <span class = "likeCount">
                                    26
                                </span> 좋아요
                                <br>
                                <span class = "likeDate">
                                    2017/10/03
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "likePoemTitle">
                        <div class = "poemTitle">
                            이른 이별   
                        </div>
                    </div>
                </div>
                <div class = "likePoems">
                    <div class = "likePoemPics" id = "thirdLike">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "likeAuthor">
                                    신연
                                </span>
                                <br>
                                <span class = "likeCount">
                                    117
                                </span> 좋아요
                                <br>
                                <span class = "likeDate">
                                    2017/08/14
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "likePoemTitle">
                        <div class = "poemTitle">
                            책 속의 그녀   
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
        
        <!-- 분리 -->
        
        <div id = "recommendPoem">
            <h1>
                추천 시집
            </h1>

            <div id = "seeRecommendMoreCover">
                <div id = "seeRecommendMore">
                    더 보기
                </div>
                <img src = "../imgs/plus2.png">
            </div>
            
            <div id= "recommendPoemCover">
                <!--<div class = "recommendPoems">
                    <div class = "recommendPoemPics" id = "firstLikeR">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "recommendAuthor">
                                    김진
                                </span>
                                <br>
                                <span class = "recommendCount">
                                    41
                                </span> 좋아요
                                <br>
                                <span class = "recommendDate">
                                    2017/05/31
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "recommendPoemTitle">
                        <div class = "poemTitle">
                            매번 그럴수록    
                        </div>
                    </div>
                </div>
                <div class = "recommendPoems">
                    <div class = "recommendPoemPics" id = "secondLikeR">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "recommendAuthor">
                                    임주연
                                </span>
                                <br>
                                <span class = "recommendCount">
                                    89
                                </span> 좋아요
                                <br>
                                <span class = "recommendDate">
                                    2017/06/28
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "recommendPoemTitle">
                        <div class = "poemTitle">
                            오늘 또 다시   
                        </div>
                    </div>
                </div>
                <div class = "recommendPoems">
                    <div class = "recommendPoemPics" id = "thirdLikeR">
                        <div class = "hoverAnim">
                            <p>
                                <span class = "recommendAuthor">
                                    이유정
                                </span>
                                <br>
                                <span class = "recommendCount">
                                    104
                                </span> 좋아요
                                <br>
                                <span class = "recommendDate">
                                    2017/05/23
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class = "recommendPoemTitle">
                        <div class = "poemTitle">
                            비 내렸던 그날   
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
        
        <footer>
            
        </footer>

        <script>
            let heartedBookCover = document.getElementById('likePoemCover');
            let seeHeartedMoreCover = document.getElementById('seeLikeMoreCover');

            let recommendBookCover = document.getElementById('recommendPoemCover');
            let seeRecommendMoreCover = document.getElementById('seeRecommendMoreCover');
        </script>

        <script>
            const readMyBooks = (page, length, callback) => {
                let xhr = new XMLHttpRequest();

                xhr.onreadystatechange = (e) => {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            let response = JSON.parse(xhr.responseText);
                            callback(true, response.data);
                        } else {
                            callback(false, null);
                        }
                    }
                };

                xhr.open('GET', `http://localhost:5000/member/books?page=${page}&length=${length}`, true);
                xhr.setRequestHeader('Poem-Session-Key', localStorage.getItem('Poem-Session-Key'));
                
                xhr.send(null);
            };

            const readPopularBooks = (page, length, callback) => {
                let xhr = new XMLHttpRequest();

                xhr.onreadystatechange = (e) => {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            let response = JSON.parse(xhr.responseText);
                            callback(true, response.data);
                        } else {
                            callback(false, null);
                        }
                    }
                };

                xhr.open('GET', `http://localhost:5000/books/popular?page=${page}&length=${length}`, true);
                xhr.send(null);
            };

            const readHeartedBooks = (page, length, callback) => {
                let xhr = new XMLHttpRequest();

                xhr.onreadystatechange = (e) => {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            let response = JSON.parse(xhr.responseText);
                            callback(true, response.data);
                        } else {
                            callback(false, null);
                        }
                    }
                };

                xhr.open('GET', `http://localhost:5000/member/books/hearted?page=${page}&length=${length}`, true);
                xhr.setRequestHeader('Poem-Session-Key', localStorage.getItem('Poem-Session-Key'));

                xhr.send(null);
            };
        </script>

        <script>
            const showHeartedBooks = (page, length) => {
                readHeartedBooks(page, length, (result, books) => {
                    if (result) {
                        if (books.length < 3) {
                            seeHeartedMoreCover.style.display = 'none';
                        } else {
                            seeHeartedMoreCover.style.display = '';
                            seeHeartedMoreCover.onclick = (e) => {
                                showHeartedBooks(page + 1, length);
                            };
                        }

                        for (let book of books) {
                            let bookElement = document.createElement('div');
                            bookElement.setAttribute('class', 'likePoems');

                            let bookContent = 
                                `<div class = "likePoemPics" id = "firstLike">
                                    <div class = "hoverAnim">
                                        <p>
                                            <span class = "likeAuthor">
                                                ${book.writer}
                                            </span>
                                            <br>
                                            <span class = "likeCount">
                                                ${book.hearts}
                                            </span> 좋아요
                                            <br>
                                            <span class = "likeDate">
                                                2017/09/28
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class = "likePoemTitle">
                                    <div class = "poemTitle">
                                        ${book.title}    
                                    </div>
                                </div>`;
                            
                            bookElement.innerHTML = bookContent;
                            heartedBookCover.appendChild(bookElement);
                        }
                    } else {
                        alert(`have not anything hearted books`);
                    }
                });
            };

            let showPopularBooks = (page, length) => {
                readPopularBooks(page, length, (result, books) => {
                    if (result) {
                        if (books.length < 3) {
                            seeRecommendMoreCover.style.display = 'none';
                        } else {
                            seeRecommendMoreCover.style.display = '';
                            seeRecommendMoreCover.onclick = (e) => {
                                showRecommendBooks(page + 1, length);
                            };
                        }

                        for (let book of books) {
                            let bookElement = document.createElement('div');
                            bookElement.setAttribute('class', 'recommendPoems');

                            let bookContent = 
                                `<div class = "recommendPoemPics" id = "firstLikeR">
                                    <div class = "hoverAnim">
                                        <p>
                                            <span class = "recommendAuthor">
                                                ${book.writer}
                                            </span>
                                            <br>
                                            <span class = "recommendCount">
                                                ${book.hearts}
                                            </span> 좋아요
                                            <br>
                                            <span class = "recommendDate">
                                                2017/05/31
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class = "recommendPoemTitle">
                                    <div class = "poemTitle">
                                        ${book.title}    
                                    </div>
                                </div>`;
                            
                            bookElement.innerHTML = bookContent;
                            recommendBookCover.appendChild(bookElement);
                        }
                    } else {
                        alert(`have not anything popular books`);
                    }
                });
            }
        </script>

        <script>
           showHeartedBooks(1, 3);
           showPopularBooks(1, 3);
        </script>
    </body>
</html>